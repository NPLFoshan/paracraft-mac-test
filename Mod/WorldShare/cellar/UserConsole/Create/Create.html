<html>
    <body>
        <pe:mcml>
            <script type="text/npl" refresh="false">
                <![CDATA[
                    -- lib
                    local ParacraftLearningRoomDailyPage = NPL.load("(gl)script/apps/Aries/Creator/Game/Tasks/ParacraftLearningRoom/ParacraftLearningRoomDailyPage.lua")
                    local KpUserTag = NPL.load("(gl)script/apps/Aries/Creator/Game/mcml/keepwork/KpUserTag.lua")


                    local InternetLoadWorld = commonlib.gettable("MyCompany.Aries.Creator.Game.Login.InternetLoadWorld")
                    local UniString = commonlib.gettable("System.Core.UniString")
                    local NplBrowserLoaderPage = commonlib.gettable("NplBrowser.NplBrowserLoaderPage")

                    -- UI
                    local UserConsole = NPL.load("(gl)Mod/WorldShare/cellar/UserConsole/Main.lua")
                    local WorldList = NPL.load("(gl)Mod/WorldShare/cellar/UserConsole/WorldList.lua")
                    local UserInfo = NPL.load("(gl)Mod/WorldShare/cellar/UserConsole/UserInfo.lua")
                    local Server = NPL.load('(gl)Mod/WorldShare/cellar/Server/Server.lua')
                    local MySchool = NPL.load("(gl)Mod/WorldShare/cellar/MySchool/MySchool.lua")
                    local RegisterModal = NPL.load("(gl)Mod/WorldShare/cellar/RegisterModal/RegisterModal.lua")
                    local LoginModal = NPL.load("(gl)Mod/WorldShare/cellar/LoginModal/LoginModal.lua")

                    -- service
                    local KeepworkServiceSession = NPL.load("(gl)Mod/WorldShare/service/KeepworkService/Session.lua")

                    InternetLoadWorld.OnStaticInit()
                    InternetLoadWorld.GetEvents():AddEventListener(
                        "dataChanged",
                        function(that, event)
                            if (event.type_index == 1) then
                                UserConsole:Refresh()
                            end
                        end,
                        nil,
                        "UserConsole"
                    )

                    local page = document:GetPageCtrl()
                    Mod.WorldShare.Store:Remove("world/searchText")

                    local do_modify = false
                    local current_item_index = 1
                    local temp_modify_worldname = ''

                    function is_modifying()
                        return do_modify
                    end

                    function covert_status()
                        local currentWorld = Mod.WorldShare.Store:Get('world/currentWorld')
                        local currentEnterWorld = Mod.WorldShare.Store:Get('world/currentEnterWorld')

                        if currentEnterWorld and currentEnterWorld.foldername == currentWorld.foldername then
                            GameLogic.AddBBS(nil, L"不能重命名当前编辑的世界", 3000, "255 0 0")
                            return false
                        end

                        if do_modify then
                            -- update world name

                            if UserConsole:WorldRename(
                                current_item_index,
                                temp_modify_worldname,
                                function()
                                    WorldList:RefreshCurrentServerList(function()
                                        switch_world(current_item_index)
                                    end)
                                end
                            ) then
                                temp_modify_worldname = ''
                            else
                                temp_modify_worldname = ''
                                do_modify = not do_modify
                                page:Refresh(0.01)
                            end

                            return true
                        end

                        do_modify = not do_modify
                        page:Refresh(0.01)
                    end

                    function be_selected()
                        return Eval("index") == WorldList.worldIndex
                    end

                    function get_world_status(index)
                        return UserInfo.IsSignedIn() and not WorldList.GetCurWorldInfo("is_zip", Eval("index")) and WorldList.GetCurWorldInfo("status", Eval("index")) == index;
                    end

                    function get_world_status_icon(index)
                        if(index == 1) then
                            return 'background:url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#72 104 16 16)';
                        end

                        if(index == 2) then
                            return 'background:url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#98 104 16 16)';
                        end

                        if(index == 3) then
                            return 'background:url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#20 104 16 16)';
                        end

                        if(index == 4) then
                            return 'background:url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#46 104 16 16)';
                        end

                        if(index == 5) then
                            return 'background:url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#124 104 16 16)';
                        end
                    end

                    function get_world_status_tips()
                        return WorldList.FormatStatus(WorldList.GetCurWorldInfo("status",Eval("index")));
                    end

                    function get_share_button(style)
                        if style == 'folder' then
                            return 'background:url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#392 50 38 38)';
                        end

                        if style == 'delete' then
                            return 'background:url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#348 50 38 38)';
                        end

                        if style == 'sync' then
                            return 'background:url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#437 50 38 38)';
                        end

                        if style == 'enter' then
                            return 'background:url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#419 10 38 38)';
                        end
                    end

                    function container()
                        return 'width:850px;\
                                background:url(Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png#267 89 34 34:8 8 8 8)';
                    end

                    function header()
                        return 'height:34px;\
                                margin:2px;\
                                margin-top:5px;\
                                margin-left:5px;\
                                margin-bottom:0px';
                    end

                    function header_back()
                        return 'background-color:#ffffff33;\
                                width:28px;\
                                height:20px;\
                                background:url(Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png#217 183 28 20)';
                    end

                    function header_forward()
                        return 'background-color:#ffffff33;\
                                width:28px;\
                                height:20px;\
                                margin-left:5px;\
                                background:url(Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png#242 183 28 20)';
                    end

                    function header_refresh()
                        return 'width:28px;\
                                height:20px;\
                                margin-left:5px;\
                                background:url(Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png#267 183 28 20)';
                    end

                    function get_world_version()
                        return WorldList.GetCurWorldInfo("revision", Eval("index")) or 0
                    end

                    function get_world_size()
                        return Mod.WorldShare.Utils.FormatFileSize(WorldList.GetLatestSize(Eval("index")))
                    end

                    function can_be_sync()
                        return UserInfo.IsSignedIn() and not WorldList.GetCurWorldInfo("is_zip", Eval("index"))
                    end

                    function get_world_date()
                        return WorldList.FormatDatetime(WorldList.GetCurWorldInfo("modifyTime", Eval("index")))
                    end

                    function selected_version(index)
                        WorldList:SelectVersion(tonumber(index))
                    end

                    function go_to_url()
                        local url = Page:GetValue("content","");

                        local pid = UserConsole:GetProjectId(url)

                        if pid then
                            UserConsole:HandleWorldId(pid)
                        else
                            InternetLoadWorld.GotoUrl(url)
                        end
                    end

                    function show_history()
                        UserConsole:ShowHistoryManager()
                    end

                    function on_click_lesson()
                        UserConsole:ClosePage()
                        NPL.load("(gl)script/apps/Aries/Creator/Game/Login/ParaWorldLessons.lua");
                        local ParaWorldLessons = commonlib.gettable("MyCompany.Aries.Game.MainLogin.ParaWorldLessons")
                        ParaWorldLessons.ShowPage()
                    end

                    function refresh()
                        WorldList:RefreshCurrentServerList()
                    end

                    function username()
                        local userType = Mod.WorldShare.Store:Get('user/userType')
                        local isVip = Mod.WorldShare.Store:Get('user/isVip')
                        local username = UserInfo.GetUserName()
                        local textWidth = _guihelper.GetTextWidth(username)

                        local styleStr = ''

                        local user_info = {}
                        local count = 0

                        if userType.teacher then
                            user_info.tLevel = 1
                            count = count + 1
                            end
                            
                        if userType.student then
                            user_info.student = 1
                            count = count + 1
                        end
                            
                        if isVip then
                            user_info.vip = 1
                            count = count + 1
                        end

                        styleStr = KpUserTag.GetMcml(user_info)

                        if not styleStr or styleStr == "" then
                            styleStr = styleStr ..  '<div style="text-align: center">' .. username .. '</div>'
                        else
                            local margin_left = 0

                            if count >= 2 then
                                count = 2
                            end

                            margin_left = (140 - textWidth - 2 - 18 * count) / 2

                            styleStr = '<div style="float: left;margin-left: ' .. margin_left .. 'px;margin-top: 2px;">' .. styleStr .. '</div>' .. '<div style="float: left;margin-left: 2px;">' .. username .. '</div>'
                        end

                        return styleStr
                    end

                    function register()
                        RegisterModal:ShowPage(function()
                            WorldList:RefreshCurrentServerList()
                        end)
                    end

                    function login()
                        UserInfo:OnClickLogin()
                    end

                    function logout()
                        UserInfo:Logout()
                    end

                    function close()
                        if System.options.mc == true then
                            if Mod.WorldShare.Store:Get("world/isEnterWorld") then
                                UserConsole:ClosePage()
                            else
                                if is_signed_in() then
                                    logout()
                                end

                                UserConsole:ClosePage()
                                UserConsole:EnterMainLogin()
                            end
                        else
                            UserConsole:ClosePage()
                        end
                    end

                    function is_list_refreshing()
                        return WorldList:IsRefreshing()
                    end

                    function switch_world(index)
                        do_modify = false
                        current_item_index = index
                        WorldList:OnSwitchWorld(index)
                    end

                    function on_change_avatar(name)
                        UserInfo:OnChangeAvatar(name)
                    end

                    function is_signed_in()
                        return UserInfo.IsSignedIn()
                    end

                    function delete_world(index)
                        WorldList:DeleteWorld(index)
                    end

                    function sync(index)
                        WorldList:Sync(index)
                    end

                    function enter(index)
                        WorldList:EnterWorld(index)
                    end

                    function create_new_world()
                        UserConsole:CreateNewWorld()
                    end

                    function import_world()
                        UserConsole.OnImportWorld()
                    end

                    function official_worlds()
                        UserConsole.OnClickOfficialWorlds()
                    end

                    function get_world_text()
                        if type(Eval("text")) ~= 'string' then
                            return ''
                        end

                        local text = Eval("text")

                        if _guihelper.GetTextWidth(text) > 150 then
                            local function chsize(char)
                                if not char then
                                    return 0
                                elseif char > 240 then
                                    return 4
                                elseif char > 225 then
                                    return 3
                                elseif char > 192 then
                                    return 2
                                else
                                    return 1
                                end
                            end

                            local len = 0
                            local count = 0
                            local currentIndex = 1

                            while currentIndex <= #text do
                                local charsizenum = chsize(string.byte(text, currentIndex))

                                currentIndex = currentIndex + charsizenum

                                if len >= 25 then
                                    break
                                end

                                if charsizenum ~= 0 then
                                    count = count + 1

                                    if charsizenum >= 3 then
                                        len = len + 3.2
                                    else
                                        len = len + 1.5
                                    end
                                end
                            end

                            text = UniString:new(text):sub(1, count).text .. '...'
                        end

                        if Eval("is_zip") == true then
                            text = text .. '.zip'
                        end

                        return text
                    end

                    function open_project(index)
                        WorldList:OpenProject(index)
                    end

                    function my_school()
                        -- UserConsole:ClosePage()
                        MySchool:Show()
                    end

                    function update_temp_modify_worldname(name, mcmlNode)
                        temp_modify_worldname = mcmlNode:GetUIValue()
                    end

                    function get_tagname()
                        if Eval("local_tagname") and Eval("local_tagname") ~= "" then
                            return Eval("local_tagname")
                        else
                            return Eval("remote_tagname")
                        end
                    end

                    function show_servers()
                        Server:ShowPage()
                    end

                    function org_img_url()
                        local myOrg = Mod.WorldShare.Store:Get('user/myOrg')

                        if type(myOrg) == 'table' and type(myOrg.logo) == 'string' then
                            return myOrg.logo
                        else
                            return ''
                        end
                    end

                    function has_org()
                        local url = org_img_url()

                        if type(url) == 'string' and #url > 0 then
                            return true
                        else
                            return false
                        end
                    end

                    function is_multiplayer_edit()
                        local project = WorldList.GetCurWorldInfo("project",Eval("index"))
                        
                        if (project and project.memberCount or 0) > 1 then
                            return "background: url(Texture/whitedot.png);background-color: #644c98;"
                        else
                            return ""
                        end
                    end

                    function classification()
                        RegisterModal:ShowClassificationPage(function()
                            WorldList:RefreshCurrentServerList()
                        end)
                    end

                    function is_verified()
                        return Mod.WorldShare.Store:Get("user/isVerified") == true and true or false
                    end
                    
                    function get_classification_style()
                        if Mod.WorldShare.Utils.IsEnglish() then
                            return 'margin-left: -6px;'
                        else
                            return 'margin-left: 40px;'
                        end
                    end

                    function IsOsSupported()
                        if(System and System.os and System.os.GetPlatform)then
                            local platform = System.os.GetPlatform();
                            if(platform == "win32" or platform == "mac" )then
                                return true;
                            end
                        end
                    end

                    function OnDailyCheck()
                        NplBrowserLoaderPage.Check(function()
                            if(KeepworkServiceSession:IsSignedIn())then
                                ParacraftLearningRoomDailyPage.DoCheckin();
                                return
                            end
                            LoginModal:CheckSignedIn(L"请先登录", function(result)
                            if result == true then
                                Mod.WorldShare.Utils.SetTimeOut(function()
                                    if result then
                                        WorldList:RefreshCurrentServerList()
                                        local ParacraftLearningRoomDailyPage = NPL.load("(gl)script/apps/Aries/Creator/Game/Tasks/ParacraftLearningRoom/ParacraftLearningRoomDailyPage.lua");
                                        ParacraftLearningRoomDailyPage.DoCheckin();
                                    end
                                end, 500)
                            end
                        end)
                        end)
                    end

                    function OnLearningLand()
                        if(KeepworkServiceSession:IsSignedIn())then
                            ParacraftLearningRoomDailyPage.OnLearningLand();
                            return
                        end
                        LoginModal:CheckSignedIn(L"请先登录", function(result)
                            if result == true then
                                Mod.WorldShare.Utils.SetTimeOut(function()
                                    if result then
                                        WorldList:RefreshCurrentServerList()
                                        local ParacraftLearningRoomDailyPage = NPL.load("(gl)script/apps/Aries/Creator/Game/Tasks/ParacraftLearningRoom/ParacraftLearningRoomDailyPage.lua");
                                        ParacraftLearningRoomDailyPage.OnLearningLand();
                                    end
                                end, 300)
                            end
                        end)
                    end

                    function OnVIP()
                        ParacraftLearningRoomDailyPage.OnVIP();
                    end

                    function HasCheckedToday()
                        return (not ParacraftLearningRoomDailyPage.HasCheckedToday());
                    end

                    function has_setted_my_school()
                        return not Mod.WorldShare.Store:Get('user/hasJoinedSchoolOrOrg')
                    end

                    function search()
                        local search_text = page:GetValue('search_text')

                        if type(search_text) == "string" then
                            Mod.WorldShare.Store:Set("world/searchText", search_text)
                            refresh()
                        end
                    end

                    function get_last_serch_text()
                        local searchText = Mod.WorldShare.Store:Get("world/searchText")

                        if type(searchText) == "string" and searchText ~= "" then
                            return searchText
                        end
                    end

                    function set_search_button()
                        local search_text = page:GetValue('search_text')

                        if type(search_text) == "string" and #search_text > 0 then
                            page:FindControl('search_button').visible = true
                        else
                            page:FindControl('search_button').visible = false
                        end
                    end

                    function select_type(index)
                        echo(index, true)
                    end
                ]]>
            </script>
            <style type="text/mcss">
                {
                    my_school_button = {
                        ["min-width"] = 100,
                        height  = 28,
                        color = '#ffffff',
                        background = "Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png#208 89 21 21:8 8 8 8",
                    },
                    login_button = {
                        ["min-width"] = 100,
                        height = 28,
                        color = "#cccccc",
                        background = "Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png;179 89 21 21:8 8 8 8",
                    },
                    user_area = {
                        float = "left",
                        width  = 158,
                        height = 450,
                    },
                    world_area = {
                        float = "left",
                        width  = 840,
                        height = 450,
                        ["padding-top"] = 5, 
                        ["padding-left"] = 20,
                        ["padding-right"] = 0,
                    },
                    events_area = {
                        float = "left",
                        width  = 340,
                        height = 450,
                        ["padding-top"] = 10,
                        ["padding-left"] = 10,
                        ["padding-right"] = 10,
                    },
                    add_server_text_field = {
                        textcolor = "#ffffff",
                        float = "left",
                        height = 30,
                        background = "Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png;263 346 36 36:15 15 15 15",
                    },
                    share_selected_item = {
                        ["margin-right"] = 8,
                        width = 260,
                        height = 250,
                        background = "Texture/Aries/Creator/keepwork/worldshare_32bits.png;471 212 30 30:11 11 11 11",
                    },
                    share_unselect_item = {
                        ["margin-right"] = 8,
                        ["margin-bottom"] = 8,
                        ["padding-top"] = 4,
                        width = 260,
                        height = 250,
                        background = "Texture/Aries/Creator/keepwork/worldshare_32bits.png;435 212 30 30:11 11 11 11",
                    },
                    share_world_name = {
                        ["text-singleline"] = "true",
                        width = 30,
                        float = "left",
                        ["base-font-size"] = 16,
                        ["font-size"] = 16,
                        ["margin-top"] = 2,
                        ["text-align"] = "left",
                        color = "#000000",
                    },
                    project_id = {
                        position = "relative",
                        height = 17,
                        width = 85,
                        ["margin-left"] = 200,
                        ["margin-top"] = -27,
                        ["font-size"] = 11,
                        ["base-font-size"] = 11,
                        color = "#cccccc",
                        ["text-align"] = "center",
                        background = "Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png;179 89 21 21:8 8 8 8"
                    },
                    share_world_info = {
                        ["text-singleline"] = "true",
                        float = "left",
                        ["margin-left"] = 0,
                        height = 18,
                        ["font-size"] = 12,
                        color = "#9e9e9e",
                    },
                    share_world_info_button = {
                        ["margin-left"] = 0,
                        ["margin-top"] = 3,
                    },
                    share_button = {
                        width = 36,
                        height = 37,
                        ["margin-right"] = 6,
                    },
                    status = {
                        float = "left",
                        padding = 8,
                        width = 16,
                        height = 16,
                        ["margin-top"] = 8,
                        ["margin-bottom"] = 8,
                        ["margin-left"] = 2,
                        ["margin-right"] = 4,
                    },
                    common_button = {
                        height = 30,
                        spacing = 20,
                        ["font-weight"] = "bold",
                        ["font-size"]   = 14,
                    },
                    nav_button = {
                        color = "#cccccc",
                        background = "",
                        ["margin-top"] = 0,
                        height=28,
                        background2 = "Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png;179 89 21 21:8 8 8 8",
                    },
                    flat_button = {
                        color = "#cccccc",
                        ["margin-top"] = 0,
                        background = "Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png;179 89 21 21:8 8 8 8",
                    },
                    link_big_event = {
                        ["background"] = "",
                        ["padding-left"] = 0,
                        ["padding-top"] = 0,
                        ["padding-right"] = 0,
                        ["padding-bottom"] = 0,
                        background = "",
                    },
                    big_event_item = {
                        ["margin-bottom"] = 20,
                        ["padding-left"] = 5,
                        ["padding-top"] = 5,
                        width  = 295,
                        height = 65,
                        ["background-color"] = "#454340",
                    },
                    event_title = {
                        ["base-font-size"] = 16,
                        ["font-size"] = 16,
                        ["margin-top"] = 2,
                        ["text-align"] = "left",
                        color = "#ffffff",
                    },
                    left_arrow = {
                        float = "left",
                        ["background-color"] = "#33ff33",
                        width = 18,
                        height = 18,
                        ["margin-top"] = 4,
                        background = "Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png#223 148 18 18"
                    },
                    menu_select = {
                        width = 92,
                        height = 30,
                        background = "Texture/Aries/Creator/keepwork/worldshare_32bits.png;175 100 32 26:12 13 12 12",
                        ["margin-right"] = 8,
                    }
                }
            </style>
            <kp:window width="850" height="490" icon="Texture/Aries/Creator/keepwork/Window/title/biaoti_chuangzao_32bits.png" onclose="close()">
                <div style="<%=header()%>" width="100%">
                </div>
                <div class="world_area">
                    <div style="height: 30px;margin-bottom: 3px;">
                        <div style="float:left;">
                            <div class="menu_select" style="float:left">
                                <input type="button" style="position: relative;width: 92px;height: 30px;background:" name="1" onclick="select_type"/>
                                <div style="width: 30px;height: 14px;margin-left: 30px;margin-top: 10px;background: url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#284 267 30 14)"></div>
                            </div>
                            <div class="menu_select" style="float:left">
                                <input type="button" style="position: relative;width: 92px;height: 30px;background:" name="2" onclick="select_type"/>
                                <div style="width: 30px;height: 14px;margin-left: 30px;margin-top: 10px;background: url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#370 267 30 14)"></div>
                            </div>
                            <div class="menu_select" style="float:left">
                                <input type="button" style="position: relative;width: 92px;height: 30px;background:" name="3" onclick="select_type"/>
                                <div style="width: 30px;height: 14px;margin-left: 30px;margin-top: 10px;background: url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#111 267 30 14)"></div>
                            </div>
                        </div>
                        <div style="float:left;margin-left:380px;height: 37px;width:130px;margin-top: -3px;background: url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#264 46 38 34:12 12 14 12)">
                            <input type="button"
                                   style="position: relative;width: 130px;height: 37px;background:"
                                   onclick="create_new_world()"/>
                            <div style="float: left;margin-left: 10px;margin-top: 5px;width: 22px;height: 23px;background: url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#310 16 22 23)"></div>
                            <div style="float: left;margin-left: 3px;margin-top: 8px;width: 77px;height: 17px;background: url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#337 19 77 17)"></div>
                            <div style=""></div>
                        </div>
                    </div>
                    <div style="height:400px;">
                        <pe:if style="margin-top:10px;font-weight:bold;color:#ffffff" condition="<%= is_list_refreshing() %>">
                            <%=L"正在刷新, 请稍候 ... " %>
                        </pe:if>
                        <pe:if style="margin-top:10px;font-weight:bold;color:#ffffff" condition="<%= not is_list_refreshing() %>">
                            <pe:gridview 
                                RememberScrollPos="true"
                                AllowPaging="true"
                                pagesize="25"
                                VerticalScrollBarStep="80"
                                DefaultNodeHeight="200"
                                CellPadding="0"
                                ItemsPerLine="3"
                                name="gw_world_ds">
                                <Columns>
                                    <!--selected-->
                                    <pe:if condition='<%= be_selected()%>'>
                                        <div name='<%=Eval("index")%>' class="share_selected_item" style="padding-top: 6px;padding-left: 4px;">
                                            <div style="width: 248px;height: 238px;padding: 4px;background: url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#72 20 16 16:2 2 2 2)">
                                                <div style="width: 240px;height: 130px;background-color: #afafaf;">
                                                    <div style="position: relative;width: 240px;height: 130px;background: url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#394 211 32 32:9 9 9 9)"></div>
                                                </div>
                                                <div style="position: relative; width: 32px;height: 32px;">
                                                    <pe:if condition='<%= get_world_status(1)%>'>
                                                        <div class="status" style="<%= get_world_status_icon(1) %>" tooltip='<%= get_world_status_tips()%>' />
                                                    </pe:if>
                                                    <pe:if condition='<%= get_world_status(2)%>'>
                                                        <div class="status" style="<%= get_world_status_icon(2) %>" tooltip='<%= get_world_status_tips()%>' />
                                                    </pe:if>
                                                    <pe:if condition='<%= get_world_status(3)%>'>
                                                        <div class="status" style="<%= get_world_status_icon(3) %>" tooltip='<%= get_world_status_tips()%>' />
                                                    </pe:if>
                                                    <pe:if condition='<%= get_world_status(4)%>'>
                                                        <div class="status" style="<%= get_world_status_icon(4) %>" tooltip='<%= get_world_status_tips()%>' />
                                                    </pe:if>
                                                    <pe:if condition='<%= get_world_status(5)%>'>
                                                        <div class="status" style="<%= get_world_status_icon(5) %>" tooltip='<%= get_world_status_tips()%>' />
                                                    </pe:if>
                                                    <pe:if condition='<%= not can_be_sync()%>'>
                                                        <div style="float:left;width:9px;height:32px;background:#fff" />
                                                    </pe:if>
                                                </div>
                                                <div style="margin-left: 20px;">
                                                    <div class="share_world_name">
                                                        <%= get_world_text() %>
                                                        <%= '#' .. (Eval('kpProjectId') or '') %>
                                                        <%= 'v' .. get_world_version() %>
                                                        <pe:if condition='<%= Eval("project") and tonumber(Eval("project")["visibility"]) == 1 %>'>
                                                            <div style="float:left;margin-top:5px;margin-left:5px;background: url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#223 309 20 20);width: 14px;height: 14px;"></div>
                                                        </pe:if>
                                                    </div>
                                                </div>
                                                <div style="margin-left: 20px;">
                                                    <div class="share_world_info">
                                                        <span style="margin-left:0px;">
                                                            <%= get_world_date() %>
                                                        </span>
                                                        <pe:if condition='<%= not Eval("is_zip") %>'>
                                                            <span style="float:left;margin-left:15px;">
                                                                <%= get_world_size() %>
                                                            </span>
                                                        </pe:if>
                                                        <pe:if condition='<%= type(Eval("is_zip")) == "boolean" and Eval("is_zip") %>'>
                                                            <span style="float:left;margin-left:15px;">
                                                                <%= get_world_size() %>
                                                            </span>
                                                        </pe:if>
                                                    </div>
                                                </div>
                                                <div class="share_world_info_button" align="right" style="width: 170px;margin-right: -10px;">
                                                    <!-- open current world folder -->
                                                    <input type="button"
                                                           class="share_button"
                                                           style="<%= get_share_button('folder') %>"
                                                           onclick="open_folder"
                                                           tooltip="<%=L'打开世界文件夹' %>"
                                                           name='<%= Eval("index") %>' />
                                                    <!-- delete -->
                                                    <input type="button"
                                                           class="share_button"
                                                           style="<%= get_share_button('delete') %>"
                                                           onclick='delete_world'
                                                           tooltip='<%=L"删除"%>'
                                                           name='<%=Eval("index")%>' />
                                                    <pe:if condition='<%= can_be_sync()%>'>
                                                        <!-- sync -->
                                                        <input type="button"
                                                               class="share_button"
                                                               style="<%= get_share_button('sync') %>"
                                                               onclick="sync"
                                                               tooltip='<%=L"同步"%>'
                                                               name='<%=Eval("index")%>' />
                                                    </pe:if>
                                                    <!-- enter -->
                                                    <input type="button"
                                                           class="share_button"
                                                           style="<%= get_share_button('enter') %>"
                                                           onclick="enter"
                                                           tooltip='<%=L"进入"%>'
                                                           name='<%=Eval("index")%>' />
                                                </div>
                                            </div>
                                        </div>
                                    </pe:if>
                                    <!--not selected-->
                                    <pe:if condition='<%= not be_selected() %>'>
                                        <div name='<%=Eval("index")%>' class="share_unselect_item" style="padding-left:8px;padding-top:8px;">
                                            <input type="button" style="position: relative;width:260px;height:250px;background:" name='<%=Eval("index")%>' onclick="switch_world" />
                                            <div style="width: 240px;height: 130px;background-color: #afafaf;">
                                                <div style="position: relative;width: 240px;height: 130px;background: url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#394 211 32 32:9 9 9 9)"></div>
                                            </div>
                                            <div style="position: relative;width: 32px;height: 32px;">
                                                <pe:if condition='<%= get_world_status(1) %>'>
                                                    <div class="status" style="<%= get_world_status_icon(1) %>" tooltip='<%= get_world_status_tips()%>' />
                                                </pe:if>
                                                <pe:if condition='<%= get_world_status(2) %>'>
                                                    <div class="status" style="<%= get_world_status_icon(2) %>" tooltip='<%= get_world_status_tips()%>' />
                                                </pe:if>
                                                <pe:if condition='<%= get_world_status(3) %>'>
                                                    <div class="status" style="<%= get_world_status_icon(3) %>" tooltip='<%= get_world_status_tips()%>' />
                                                </pe:if>
                                                <pe:if condition='<%= get_world_status(4) %>'>
                                                    <div class="status" style="<%= get_world_status_icon(4) %>" tooltip='<%= get_world_status_tips()%>' />
                                                </pe:if>
                                                <pe:if condition='<%= get_world_status(5) %>'>
                                                    <div class="status" style="<%= get_world_status_icon(5) %>" tooltip='<%= get_world_status_tips()%>' />
                                                </pe:if>
                                                <pe:if condition='<%= not can_be_sync()%>'>
                                                    <div style="float:left;width:9px;height:32px;background:#fff" />
                                                </pe:if>
                                            </div>
                                            <div style="margin-left: 20px;">
                                                <div class="share_world_name">
                                                    <%= get_world_text() %>
                                                    <%= '#' .. (Eval('kpProjectId') or '') %>
                                                    <%= 'v' .. get_world_version() %>
                                                    <pe:if condition='<%= Eval("project") and Eval("project")["visibility"] and tonumber(Eval("project")["visibility"]) == 1 %>'>
                                                        <div style="float:left;margin-top:5px;margin-left:5px;background: url(Texture/Aries/Creator/keepwork/worldshare_32bits.png#223 309 20 20);width: 14px;height: 14px;"></div>
                                                    </pe:if>
                                                </div>
                                            </div>
                                            <div style="margin-left: 20px;">
                                                <div class="share_world_info">
                                                    <span style="float:left;margin-left:0px;">
                                                        <%= get_world_date() %>
                                                    </span>
                                                    <pe:if condition='<%= not Eval("is_zip") %>'>
                                                        <span style="float:left;margin-left:10px;">
                                                            v<%= get_world_version() %>
                                                        </span>
                                                        <span style="float:left;margin-left:10px;">
                                                            <%= get_world_size() %>
                                                        </span>
                                                    </pe:if>
                                                </div>
                                            </div>
                                            <div align="right" class="share_world_info_button"  style="margin-right: 12px;width:30px;height:30px;">
                                                <!-- ENTER -->
                                                <input type="button"
                                                       class="share_button"
                                                       style="<%= get_share_button('enter') %>"
                                                       onclick="enter"
                                                       tooltip='<%=L"进入"%>'
                                                       name='<%=Eval("index")%>' />
                                            </div>
                                        </div>
                                    </pe:if>
                                </Columns>
                                <EmptyDataTemplate>
                                    <div style="margin:10px;font-weight:bold;color:#ffffff">
                                        <%=L"暂无存档，请创建" %>
                                    </div>
                                </EmptyDataTemplate>
                                <FetchingDataTemplate>
                                    <div style="margin-top:10px;font-weight:bold;color:#ffffff">
                                        <%=L"正在搜索, 请稍候 ... " %>
                                    </div>
                                </FetchingDataTemplate>
                                <PagerSettings Position="Bottom" />
                                <PagerTemplate AutoHidePager="true" style="margin-top: 8px;margin-left: 80px;">
                                    <form>
                                        <input type="button" name="pre" zorder="2" class="mc_light_grey_button_with_fillet" style="float:left;height: 20px;font-size: 13px;" value="<%= L'上一页' %>"/>
                                        <label name="page" style="color:#ffffff;height:18px;width: 50px;text-align: center;margin-top: -2px;"></label>
                                        <input type="button" name="next" zorder="2" class="mc_light_grey_button_with_fillet" style="float:left;height: 20px;font-size: 13px;" value="<%= L'下一页' %>"/>
                                    </form>
                                </PagerTemplate>
                            </pe:gridview>
                        </pe:if>
                    </div>
                </div>
            </kp:window>
        </pe:mcml>
    </body>
</html>
